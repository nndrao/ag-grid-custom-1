<!DOCTYPE html>
<html>
<head>
    <title>Column Settings Flow</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .diagram-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        .mermaid {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>AG-Grid Column Settings Flow</h1>
    
    <div class="diagram-container">
        <h2>1. Column Settings Dialog - Apply Changes</h2>
        <div class="mermaid">
            graph TD
                A[User Opens Column Settings Dialog] --> B[Load Current Column Defs from Grid API]
                B --> C[Load Saved Settings from Profile Store]
                C --> D[Merge Settings & Display in Dialog]
                D --> E[User Modifies Settings]
                E --> F[User Clicks Apply Changes]
                F --> G[Apply to Grid via updateGridOptions]
                F --> H[Save to Profile via ColumnSettingsPersistence]
                H --> I[Update Active Profile in Memory]
                
                style A fill:#e8f5e9
                style F fill:#ffecb3
                style G fill:#bbdefb
                style I fill:#f3e5f5
        </div>
    </div>

    <div class="diagram-container">
        <h2>2. Save Profile Button Click</h2>
        <div class="mermaid">
            graph TD
                A[User Clicks Save Profile] --> B[ProfileManager.saveCurrentProfile]
                B --> C[SettingsController.collectCurrentSettings]
                C --> D[Get Column Defs from Grid API]
                C --> E[Get Other Settings]
                D --> F[Combine All Settings]
                E --> F
                F --> G[ProfileStore.updateProfile]
                G --> H[Save to LocalStorage]
                
                style A fill:#e8f5e9
                style B fill:#ffecb3
                style G fill:#bbdefb
                style H fill:#f3e5f5
        </div>
    </div>

    <div class="diagram-container">
        <h2>3. App Load - Settings Restoration</h2>
        <div class="mermaid">
            graph TD
                A[App Starts] --> B[DataTable Component Renders]
                B --> C[Initialize ProfileManager]
                C --> D[Load Profiles from LocalStorage]
                D --> E[Get Active Profile]
                E --> F[ColumnSettingsPersistence.getColumnSettings]
                F --> G[Extract columnDefs from Profile]
                G --> H[Merge with Default Column Defs]
                H --> I[Pass to AG-Grid]
                I --> J[Grid Renders with Saved Settings]
                
                style A fill:#e8f5e9
                style E fill:#ffecb3
                style H fill:#bbdefb
                style J fill:#f3e5f5
        </div>
    </div>

    <div class="diagram-container">
        <h2>4. Profile Switch</h2>
        <div class="mermaid">
            graph TD
                A[User Selects Different Profile] --> B[ProfileManager.switchProfile]
                B --> C[Set New Active Profile]
                C --> D[SettingsController.applyProfileSettings]
                D --> E[Extract columnDefs from New Profile]
                E --> F[Apply to Grid via setGridOption]
                F --> G[Grid Re-renders with New Settings]
                
                style A fill:#e8f5e9
                style C fill:#ffecb3
                style F fill:#bbdefb
                style G fill:#f3e5f5
        </div>
    </div>

    <div class="diagram-container">
        <h2>Data Flow Overview</h2>
        <div class="mermaid">
            graph LR
                subgraph "User Interface"
                    UI[Column Settings Dialog]
                    GRID[AG-Grid]
                end
                
                subgraph "Services"
                    CSP[ColumnSettingsPersistence]
                    SC[SettingsController]
                    PM[ProfileManager]
                end
                
                subgraph "Storage"
                    PS[ProfileStore]
                    LS[LocalStorage]
                end
                
                UI -->|Apply Changes| CSP
                CSP -->|Save| PS
                PS -->|Persist| LS
                LS -->|Load| PS
                PS -->|Restore| CSP
                CSP -->|Apply| GRID
                SC <-->|Manage| PS
                PM <-->|Orchestrate| SC
                
                style UI fill:#e8f5e9
                style GRID fill:#e8f5e9
                style CSP fill:#ffecb3
                style SC fill:#ffecb3
                style PM fill:#ffecb3
                style PS fill:#bbdefb
                style LS fill:#f3e5f5
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#fff',
                primaryTextColor: '#000',
                primaryBorderColor: '#000',
                lineColor: '#000',
                background: '#f4f4f4'
            }
        });
    </script>
</body>
</html>